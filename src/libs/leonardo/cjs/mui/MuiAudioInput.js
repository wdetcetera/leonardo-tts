"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MuiAudioInput = MuiAudioInput;

var _material = require("@mui/material");

var _react = _interopRequireDefault(require("react"));

var _audioMediaRecorder = require("../audio-media-recorder");

function MuiAudioInput({
  chatController,
  actionRequest
}) {
  const chatCtl = chatController;

  const [audioRec] = _react.default.useState(_audioMediaRecorder.AudioMediaRecorder.getInstance());

  const [stopped, setStopped] = _react.default.useState(true);

  const [audio, setAudio] = _react.default.useState();

  const handleError = _react.default.useCallback(error => {
    const value = {
      type: 'audio',
      value: error.message,
      error
    };
    chatCtl.setActionResponse(actionRequest, value);
  }, [actionRequest, chatCtl]);

  const handleStart = _react.default.useCallback(async () => {
    try {
      await audioRec.initialize();
      await audioRec.startRecord();
      setStopped(false);
    } catch (error) {
      handleError(error);
    }
  }, [audioRec, handleError]);

  const handleStop = _react.default.useCallback(async () => {
    try {
      const a = await audioRec.stopRecord();
      setAudio(a);
      setStopped(true);
    } catch (error) {
      handleError(error);
    }
  }, [audioRec, handleError]);

  const sendResponse = _react.default.useCallback(() => {
    if (audio) {
      const value = {
        type: 'audio',
        value: 'Audio',
        audio
      };
      chatCtl.setActionResponse(actionRequest, value);
      setAudio(undefined);
    }
  }, [actionRequest, audio, chatCtl]);

  const sendButtonText = actionRequest.sendButtonText ? actionRequest.sendButtonText : 'Send';
  return /*#__PURE__*/_react.default.createElement(_material.Box, {
    sx: {
      flex: '1 1 auto',
      display: 'flex',
      '& > *': {
        flex: '1 1 auto',
        minWidth: 0
      },
      '& > * + *': {
        ml: 1
      }
    }
  }, stopped && /*#__PURE__*/_react.default.createElement(_material.Button, {
    type: "button",
    onClick: handleStart,
    disabled: !stopped,
    variant: "contained",
    color: "primary",
    startIcon: /*#__PURE__*/_react.default.createElement(_material.Icon, null, "keyboard_voice")
  }, "Rec start"), !stopped && /*#__PURE__*/_react.default.createElement(_material.Button, {
    type: "button",
    onClick: handleStop,
    disabled: stopped,
    variant: "contained",
    color: "primary",
    startIcon: /*#__PURE__*/_react.default.createElement(_material.Icon, null, "stop")
  }, "Rec stop"), /*#__PURE__*/_react.default.createElement(_material.Button, {
    type: "button",
    onClick: sendResponse,
    disabled: !audio,
    variant: "contained",
    color: "primary",
    startIcon: /*#__PURE__*/_react.default.createElement(_material.Icon, null, "send")
  }, sendButtonText));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tdWkvTXVpQXVkaW9JbnB1dC50c3giXSwibmFtZXMiOlsiTXVpQXVkaW9JbnB1dCIsImNoYXRDb250cm9sbGVyIiwiYWN0aW9uUmVxdWVzdCIsImNoYXRDdGwiLCJhdWRpb1JlYyIsIlJlYWN0IiwidXNlU3RhdGUiLCJBdWRpb01lZGlhUmVjb3JkZXIiLCJnZXRJbnN0YW5jZSIsInN0b3BwZWQiLCJzZXRTdG9wcGVkIiwiYXVkaW8iLCJzZXRBdWRpbyIsImhhbmRsZUVycm9yIiwidXNlQ2FsbGJhY2siLCJlcnJvciIsInZhbHVlIiwidHlwZSIsIm1lc3NhZ2UiLCJzZXRBY3Rpb25SZXNwb25zZSIsImhhbmRsZVN0YXJ0IiwiaW5pdGlhbGl6ZSIsInN0YXJ0UmVjb3JkIiwiaGFuZGxlU3RvcCIsImEiLCJzdG9wUmVjb3JkIiwic2VuZFJlc3BvbnNlIiwidW5kZWZpbmVkIiwic2VuZEJ1dHRvblRleHQiLCJmbGV4IiwiZGlzcGxheSIsIm1pbldpZHRoIiwibWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUVBOztBQUlPLFNBQVNBLGFBQVQsQ0FBdUI7QUFDNUJDLEVBQUFBLGNBRDRCO0FBRTVCQyxFQUFBQTtBQUY0QixDQUF2QixFQU1nQjtBQUNyQixRQUFNQyxPQUFPLEdBQUdGLGNBQWhCOztBQUNBLFFBQU0sQ0FBQ0csUUFBRCxJQUFhQyxlQUFNQyxRQUFOLENBQWVDLHVDQUFtQkMsV0FBbkIsRUFBZixDQUFuQjs7QUFDQSxRQUFNLENBQUNDLE9BQUQsRUFBVUMsVUFBVixJQUF3QkwsZUFBTUMsUUFBTixDQUFlLElBQWYsQ0FBOUI7O0FBQ0EsUUFBTSxDQUFDSyxLQUFELEVBQVFDLFFBQVIsSUFBb0JQLGVBQU1DLFFBQU4sRUFBMUI7O0FBRUEsUUFBTU8sV0FBVyxHQUFHUixlQUFNUyxXQUFOLENBQ2pCQyxLQUFELElBQXdCO0FBQ3RCLFVBQU1DLEtBQTBCLEdBQUc7QUFDakNDLE1BQUFBLElBQUksRUFBRSxP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QkFBRDtBQUNFLElBQUEsSUFBSSxFQUFDLFFBRFA7QUFFRSxJQUFBLE9BQU8sRUFBRWlCLFlBRlg7QUFHRSxJQUFBLFFBQVEsRUFBRSxDQUFDZixLQUhiO0FBSUUsSUFBQSxPQUFPLEVBQUMsV0FKVjtBQUtFLElBQUEsS0FBSyxFQUFDLFNBTFI7QUFNRSxJQUFBLFNBQVMsZUFBRSw2QkFBQyxjQUFEO0FBTmIsS0FRR2lCLGNBUkgsQ0FyQ0YsQ0FERjtBQWtERCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJveCwgQnV0dG9uLCBJY29uIH0gZnJvbSAnQG11aS9tYXRlcmlhbCc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBBdWRpb01lZGlhUmVjb3JkZXIgfSBmcm9tICcuLi9hdWRpby1tZWRpYS1yZWNvcmRlcic7XG5pbXBvcnQgeyBDaGF0Q29udHJvbGxlciB9IGZyb20gJy4uL2NoYXQtY29udHJvbGxlcic7XG5pbXBvcnQgeyBBdWRpb0FjdGlvblJlcXVlc3QsIEF1ZGlvQWN0aW9uUmVzcG9uc2UgfSBmcm9tICcuLi9jaGF0LXR5cGVzJztcblxuZXhwb3J0IGZ1bmN0aW9uIE11aUF1ZGlvSW5wdXQoe1xuICBjaGF0Q29udHJvbGxlcixcbiAgYWN0aW9uUmVxdWVzdCxcbn06IHtcbiAgY2hhdENvbnRyb2xsZXI6IENoYXRDb250cm9sbGVyO1xuICBhY3Rpb25SZXF1ZXN0OiBBdWRpb0FjdGlvblJlcXVlc3Q7XG59KTogUmVhY3QuUmVhY3RFbGVtZW50IHtcbiAgY29uc3QgY2hhdEN0bCA9IGNoYXRDb250cm9sbGVyO1xuICBjb25zdCBbYXVkaW9SZWNdID0gUmVhY3QudXNlU3RhdGUoQXVkaW9NZWRpYVJlY29yZGVyLmdldEluc3RhbmNlKCkpO1xuICBjb25zdCBbc3RvcHBlZCwgc2V0U3RvcHBlZF0gPSBSZWFjdC51c2VTdGF0ZSh0cnVlKTtcbiAgY29uc3QgW2F1ZGlvLCBzZXRBdWRpb10gPSBSZWFjdC51c2VTdGF0ZTxCbG9iIHwgdW5kZWZpbmVkPigpO1xuXG4gIGNvbnN0IGhhbmRsZUVycm9yID0gUmVhY3QudXNlQ2FsbGJhY2soXG4gICAgKGVycm9yOiBFcnJvcik6IHZvaWQgPT4ge1xuICAgICAgY29uc3QgdmFsdWU6IEF1ZGlvQWN0aW9uUmVzcG9uc2UgPSB7XG4gICAgICAgIHR5cGU6ICdhdWRpbycsXG4gICAgICAgIHZhbHVlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBlcnJvcixcbiAgICAgIH07XG4gICAgICBjaGF0Q3RsLnNldEFjdGlvblJlc3BvbnNlKGFjdGlvblJlcXVlc3QsIHZhbHVlKTtcbiAgICB9LFxuICAgIFthY3Rpb25SZXF1ZXN0LCBjaGF0Q3RsXSxcbiAgKTtcblxuICBjb25zdCBoYW5kbGVTdGFydCA9IFJlYWN0LnVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgYXVkaW9SZWMuaW5pdGlhbGl6ZSgpO1xuICAgICAgYXdhaXQgYXVkaW9SZWMuc3RhcnRSZWNvcmQoKTtcbiAgICAgIHNldFN0b3BwZWQoZmFsc2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBoYW5kbGVFcnJvcihlcnJvciBhcyBFcnJvcik7XG4gICAgfVxuICB9LCBbYXVkaW9SZWMsIGhhbmRsZUVycm9yXSk7XG5cbiAgY29uc3QgaGFuZGxlU3RvcCA9IFJlYWN0LnVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYSA9IGF3YWl0IGF1ZGlvUmVjLnN0b3BSZWNvcmQoKTtcbiAgICAgIHNldEF1ZGlvKGEpO1xuICAgICAgc2V0U3RvcHBlZCh0cnVlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaGFuZGxlRXJyb3IoZXJyb3IgYXMgRXJyb3IpO1xuICAgIH1cbiAgfSwgW2F1ZGlvUmVjLCBoYW5kbGVFcnJvcl0pO1xuXG4gIGNvbnN0IHNlbmRSZXNwb25zZSA9IFJlYWN0LnVzZUNhbGxiYWNrKCgpOiB2b2lkID0+IHtcbiAgICBpZiAoYXVkaW8pIHtcbiAgICAgIGNvbnN0IHZhbHVlOiBBdWRpb0FjdGlvblJlc3BvbnNlID0ge1xuICAgICAgICB0eXBlOiAnYXVkaW8nLFxuICAgICAgICB2YWx1ZTogJ0F1ZGlvJyxcbiAgICAgICAgYXVkaW8sXG4gICAgICB9O1xuICAgICAgY2hhdEN0bC5zZXRBY3Rpb25SZXNwb25zZShhY3Rpb25SZXF1ZXN0LCB2YWx1ZSk7XG4gICAgICBzZXRBdWRpbyh1bmRlZmluZWQpO1xuICAgIH1cbiAgfSwgW2FjdGlvblJlcXVlc3QsIGF1ZGlvLCBjaGF0Q3RsXSk7XG5cbiAgY29uc3Qgc2VuZEJ1dHRvblRleHQgPSBhY3Rpb25SZXF1ZXN0LnNlbmRCdXR0b25UZXh0XG4gICAgPyBhY3Rpb25SZXF1ZXN0LnNlbmRCdXR0b25UZXh0XG4gICAgOiAnU2VuZCc7XG5cbiAgcmV0dXJuIChcbiAgICA8Qm94XG4gICAgICBzeD17e1xuICAgICAgICBmbGV4OiAnMSAxIGF1dG8nLFxuICAgICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICAgICcmID4gKic6IHtcbiAgICAgICAgICBmbGV4OiAnMSAxIGF1dG8nLFxuICAgICAgICAgIG1pbldpZHRoOiAwLFxuICAgICAgICB9LFxuICAgICAgICAnJiA+ICogKyAqJzoge1xuICAgICAgICAgIG1sOiAxLFxuICAgICAgICB9LFxuICAgICAgfX1cbiAgICA+XG4gICAgICB7c3RvcHBlZCAmJiAoXG4gICAgICAgIDxCdXR0b25cbiAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVTdGFydH1cbiAgICAgICAgICBkaXNhYmxlZD17IXN0b3BwZWR9XG4gICAgICAgICAgdmFyaWFudD1cImNvbnRhaW5lZFwiXG4gICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgICBzdGFydEljb249ezxJY29uPmtleWJvYXJkX3ZvaWNlPC9JY29uPn1cbiAgICAgICAgPlxuICAgICAgICAgIFJlYyBzdGFydFxuICAgICAgICA8L0J1dHRvbj5cbiAgICAgICl9XG4gICAgICB7IXN0b3BwZWQgJiYgKFxuICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgb25DbGljaz17aGFuZGxlU3RvcH1cbiAgICAgICAgICBkaXNhYmxlZD17c3RvcHBlZH1cbiAgICAgICAgICB2YXJpYW50PVwiY29udGFpbmVkXCJcbiAgICAgICAgICBjb2xvcj1cInByaW1hcnlcIlxuICAgICAgICAgIHN0YXJ0SWNvbj17PEljb24+c3RvcDwvSWNvbj59XG4gICAgICAgID5cbiAgICAgICAgICBSZWMgc3RvcFxuICAgICAgICA8L0J1dHRvbj5cbiAgICAgICl9XG4gICAgICA8QnV0dG9uXG4gICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICBvbkNsaWNrPXtzZW5kUmVzcG9uc2V9XG4gICAgICAgIGRpc2FibGVkPXshYXVkaW99XG4gICAgICAgIHZhcmlhbnQ9XCJjb250YWluZWRcIlxuICAgICAgICBjb2xvcj1cInByaW1hcnlcIlxuICAgICAgICBzdGFydEljb249ezxJY29uPnNlbmQ8L0ljb24+fVxuICAgICAgPlxuICAgICAgICB7c2VuZEJ1dHRvblRleHR9XG4gICAgICA8L0J1dHRvbj5cbiAgICA8L0JveD5cbiAgKTtcbn1cbiJdfQ==