/*!
 * chat-ui-react v0.3.0
 * 
 * Copyright (c) 2020 twihike. All rights reserved.
 * This source code is licensed under the MIT license.
 */
/*!
 * @package audio-recorder-polyfill
 * @version 0.4.1
 * @license MIT
 * @author Andrey Sitnik
 * @url https://github.com/ai/audio-recorder-polyfill
 */
/*!
 * @package @babel/runtime
 * @version 7.15.4
 * @license MIT
 * @author The Babel Team
 * @url https://github.com/babel/babel
 */
/*!
 * @package dayjs
 * @version 1.10.7
 * @license MIT
 * @author iamkun
 * @url https://github.com/iamkun/dayjs
 */
/*!
 * @package regenerator-runtime
 * @version 0.13.9
 * @license MIT
 * @author Ben Newman
 * @url https://github.com/facebook/regenerator/tree/master/packages/runtime
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@mui/material"),require("react")):"function"==typeof define&&define.amd?define(["exports","@mui/material","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ChatUiReact={},t.MaterialUI,t.React)}(this,(function(t,e,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=r(n);function i(t,e,n,r,a,i,o){try{var s=t[i](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,a)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function s(t){i(o,r,a,s,u,"next",t)}function u(t){i(o,r,a,s,u,"throw",t)}s(void 0)}))}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function u(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}function c(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){l(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e,n){return e&&p(t.prototype,e),n&&p(t,n),t}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var y={exports:{}};!function(t){var e=function(t){var e,n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var a=e&&e.prototype instanceof y?e:y,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(t,e,n){var r=f;return function(a,i){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===a)throw i;return A()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=O(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=l(t,e,n);if("normal"===u.type){if(r=n.done?p:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(t,n,o),i}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var f="suspendedStart",d="suspendedYield",h="executing",p="completed",m={};function y(){}function v(){}function g(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,b=x&&x(x(D([])));b&&b!==n&&r.call(b,i)&&(w=b);var E=g.prototype=y.prototype=Object.create(w);function M(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(a,i,o,s){var u=l(t[a],t,i);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==typeof f&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(f).then((function(t){c.value=t,o(c)}),(function(t){return n("throw",t,o,s)}))}s(u.arg)}var a;this._invoke=function(t,r){function i(){return new e((function(e,a){n(t,r,e,a)}))}return a=a?a.then(i,i):i()}}function O(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=l(r,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var i=a.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function $(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function D(t){if(t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:A}}function A(){return{value:e,done:!0}}return v.prototype=g,u(E,"constructor",g),u(g,"constructor",v),v.displayName=u(g,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,s,"GeneratorFunction")),t.prototype=Object.create(E),t},t.awrap=function(t){return{__await:t}},M(k.prototype),u(k.prototype,o,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new k(c(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},M(E),u(E,s,"Generator"),u(E,i,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=D,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach($),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return s.type="throw",s.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),$(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;$(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:D(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(y);var v=y.exports,g=function(){function t(e){h(this,t),l(this,"state",void 0),l(this,"defaultOption",{delay:300}),l(this,"emptyAction",{request:{type:"empty"},responses:[],onResnponsed:[]}),l(this,"defaultActionRequest",{always:!1,addMessage:!0}),this.state={option:d(d({},this.defaultOption),e),messages:[],action:this.emptyAction,actionHistory:[],onMessagesChanged:[],onActionChanged:[]}}var e;return m(t,[{key:"addMessage",value:function(t){var e=this;return new Promise((function(n){setTimeout((function(){var r=e.state.messages.push(t)-1;e.state.messages[r].createdAt=new Date,e.callOnMessagesChanged(),n(r)}),e.state.option.delay)}))}},{key:"updateMessage",value:function(t,e){if(e!==this.state.messages[t]){var n=this.state.messages[t].createdAt;this.state.messages[t]=e,this.state.messages[t].createdAt=n}this.state.messages[t].updatedAt=new Date,this.callOnMessagesChanged()}},{key:"removeMessage",value:function(t){this.state.messages[t].deletedAt=new Date,this.callOnMessagesChanged()}},{key:"getMessages",value:function(){return this.state.messages}},{key:"setMessages",value:function(t){this.clearMessages(),this.state.messages=c(t),this.callOnMessagesChanged()}},{key:"clearMessages",value:function(){this.state.messages=[],this.callOnMessagesChanged()}},{key:"callOnMessagesChanged",value:function(){var t=this;this.state.onMessagesChanged.map((function(e){return e(t.state.messages)}))}},{key:"addOnMessagesChanged",value:function(t){this.state.onMessagesChanged.push(t)}},{key:"removeOnMessagesChanged",value:function(t){var e=this.state.onMessagesChanged.indexOf(t);this.state.onActionChanged[e]=function(){}}},{key:"setActionRequest",value:function(t,e){var n=this,r={request:d(d({},this.defaultActionRequest),t),responses:[],onResnponsed:[]};return new Promise((function(a,i){if(!t.always){r.onResnponsed.push((function(t){t.error?i(t.error):a(t)}))}e&&r.onResnponsed.push(e),n.state.action=r,n.state.actionHistory.push(r),n.callOnActionChanged(r.request),t.always&&a({type:"text",value:"dummy"})}))}},{key:"cancelActionRequest",value:function(){this.state.action=this.emptyAction,this.callOnActionChanged(this.emptyAction.request)}},{key:"getActionRequest",value:function(){var t=this.state.action,e=t.request,n=t.responses;if(e.always||!(n.length>0))return e}},{key:"setActionResponse",value:(e=o(v.mark((function t(e,n){var r,a,i,o;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.state.action,a=r.request,i=r.responses,o=r.onResnponsed,e===a){t.next=3;break}throw new Error("Invalid action.");case 3:if(e.always||0!==o.length){t.next=5;break}throw new Error("onResponsed is not set.");case 5:if(i.push(n),this.callOnActionChanged(e,n),!e.addMessage){t.next=10;break}return t.next=10,this.addMessage({type:"text",content:n.value,self:!0});case 10:o.map((function(t){return t(n)}));case 11:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"getActionResponses",value:function(){return this.state.action.responses}},{key:"callOnActionChanged",value:function(t,e){this.state.onActionChanged.map((function(n){return n(t,e)}))}},{key:"addOnActionChanged",value:function(t){this.state.onActionChanged.push(t)}},{key:"removeOnActionChanged",value:function(t){var e=this.state.onActionChanged.indexOf(t);this.state.onActionChanged[e]=function(){}}},{key:"getOption",value:function(){return this.state.option}}]),t}();let w,x=window.AudioContext||window.webkitAudioContext,b=t=>{let e=new Event("error");return e.data=new Error("Wrong state for "+t),e};class E{constructor(t,e=null){this.stream=t,this.config=e,this.state="inactive",this.em=document.createDocumentFragment(),this.encoder=(t=>{let e=t.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,""),n=new Blob([e]);return new Worker(URL.createObjectURL(n))})(E.encoder);let n=this;this.encoder.addEventListener("message",(t=>{let e=new Event("dataavailable");e.data=new Blob([t.data],{type:n.mimeType}),n.em.dispatchEvent(e),"inactive"===n.state&&n.em.dispatchEvent(new Event("stop"))}))}start(t){if("inactive"!==this.state)return this.em.dispatchEvent(b("start"));this.state="recording",w||(w=new x(this.config)),this.clone=this.stream.clone(),this.input=w.createMediaStreamSource(this.clone),this.processor=w.createScriptProcessor(2048,1,1),this.encoder.postMessage(["init",w.sampleRate]),this.processor.onaudioprocess=t=>{"recording"===this.state&&this.encoder.postMessage(["encode",t.inputBuffer.getChannelData(0)])},this.input.connect(this.processor),this.processor.connect(w.destination),this.em.dispatchEvent(new Event("start")),t&&(this.slicing=setInterval((()=>{"recording"===this.state&&this.requestData()}),t))}stop(){return"inactive"===this.state?this.em.dispatchEvent(b("stop")):(this.requestData(),this.state="inactive",this.clone.getTracks().forEach((t=>{t.stop()})),this.processor.disconnect(),this.input.disconnect(),clearInterval(this.slicing))}pause(){return"recording"!==this.state?this.em.dispatchEvent(b("pause")):(this.state="paused",this.em.dispatchEvent(new Event("pause")))}resume(){return"paused"!==this.state?this.em.dispatchEvent(b("resume")):(this.state="recording",this.em.dispatchEvent(new Event("resume")))}requestData(){return"inactive"===this.state?this.em.dispatchEvent(b("requestData")):this.encoder.postMessage(["dump",w.sampleRate])}addEventListener(...t){this.em.addEventListener(...t)}removeEventListener(...t){this.em.removeEventListener(...t)}dispatchEvent(...t){this.em.dispatchEvent(...t)}}E.prototype.mimeType="audio/wav",E.isTypeSupported=t=>E.prototype.mimeType===t,E.notSupported=!navigator.mediaDevices||!x,E.encoder=()=>{let t=[];onmessage=e=>{"encode"===e.data[0]?function(e){let n=e.length,r=new Uint8Array(2*n);for(let t=0;t<n;t++){let n=2*t,a=e[t];a>1?a=1:a<-1&&(a=-1),a*=32768,r[n]=a,r[n+1]=a>>8}t.push(r)}(e.data[1]):"dump"===e.data[0]&&function(e){let n=t.length?t[0].length:0,r=t.length*n,a=new Uint8Array(44+r),i=new DataView(a.buffer);i.setUint32(0,1380533830,!1),i.setUint32(4,36+r,!0),i.setUint32(8,1463899717,!1),i.setUint32(12,1718449184,!1),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,1,!0),i.setUint32(24,e,!0),i.setUint32(28,2*e,!0),i.setUint16(32,2,!0),i.setUint16(34,16,!0),i.setUint32(36,1684108385,!1),i.setUint32(40,r,!0);for(let e=0;e<t.length;e++)a.set(t[e],e*n+44);t=[],postMessage(a.buffer,[a.buffer])}(e.data[1])}};var M=function(){function t(){h(this,t),l(this,"md",void 0),l(this,"recordChunks",void 0),window.MediaRecorder||(window.MediaRecorder=E),this.recordChunks=[]}var e,n,r;return m(t,[{key:"initialize",value:(r=o(v.mark((function t(){var e;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.md){t.next=2;break}return t.abrupt("return",this);case 2:return t.next=4,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 4:return e=t.sent,this.md=new MediaRecorder(e),this.recordChunks=[],t.abrupt("return",this);case 8:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"startRecord",value:(n=o(v.mark((function t(){var e=this;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){if(!e.md)throw new Error("Must be initialized.");e.recordChunks=[],e.md.addEventListener("start",(function(){t()})),e.md.addEventListener("dataavailable",(function(t){t.data.size>0&&e.recordChunks.push(t.data)})),e.md.start()})));case 1:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"stopRecord",value:(e=o(v.mark((function t(){var e=this;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){if(!e.md)throw new Error("Must be initialized.");e.md.addEventListener("stop",(function(){t(new Blob(e.recordChunks))})),e.md.stop()})));case 1:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t),this.instance}}]),t}();function k(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(t){s=!0,a=t}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}l(M,"instance",void 0);var O={exports:{}};!function(t,e){t.exports=function(){var t=1e3,e=6e4,n=36e5,r="millisecond",a="second",i="minute",o="hour",s="day",u="week",c="month",l="quarter",f="year",d="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},v=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},g={s:v,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),a=n%60;return(e<=0?"+":"-")+v(r,2,"0")+":"+v(a,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),a=e.clone().add(r,c),i=n-a<0,o=e.clone().add(r+(i?-1:1),c);return+(-(r+(n-a)/(i?a-o:o-a))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:c,y:f,w:u,d:s,D:d,h:o,m:i,s:a,ms:r,Q:l}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},w="en",x={};x[w]=y;var b=function(t){return t instanceof O},E=function(t,e,n){var r;if(!t)return w;if("string"==typeof t)x[t]&&(r=t),e&&(x[t]=e,r=t);else{var a=t.name;x[a]=t,r=a}return!n&&r&&(w=r),r||!n&&w},M=function(t,e){if(b(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new O(n)},k=g;k.l=E,k.i=b,k.w=function(t,e){return M(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var O=function(){function y(t){this.$L=E(t.locale,null,!0),this.parse(t)}var v=y.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(k.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match(p);if(r){var a=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return k},v.isValid=function(){return!(this.$d.toString()===h)},v.isSame=function(t,e){var n=M(t);return this.startOf(e)<=n&&n<=this.endOf(e)},v.isAfter=function(t,e){return M(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<M(t)},v.$g=function(t,e,n){return k.u(t)?this[e]:this.set(n,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var n=this,r=!!k.u(e)||e,l=k.p(t),h=function(t,e){var a=k.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?a:a.endOf(s)},p=function(t,e){return k.w(n.toDate()[t].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},m=this.$W,y=this.$M,v=this.$D,g="set"+(this.$u?"UTC":"");switch(l){case f:return r?h(1,0):h(31,11);case c:return r?h(1,y):h(0,y+1);case u:var w=this.$locale().weekStart||0,x=(m<w?m+7:m)-w;return h(r?v-x:v+(6-x),y);case s:case d:return p(g+"Hours",0);case o:return p(g+"Minutes",1);case i:return p(g+"Seconds",2);case a:return p(g+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var n,u=k.p(t),l="set"+(this.$u?"UTC":""),h=(n={},n[s]=l+"Date",n[d]=l+"Date",n[c]=l+"Month",n[f]=l+"FullYear",n[o]=l+"Hours",n[i]=l+"Minutes",n[a]=l+"Seconds",n[r]=l+"Milliseconds",n)[u],p=u===s?this.$D+(e-this.$W):e;if(u===c||u===f){var m=this.clone().set(d,1);m.$d[h](p),m.init(),this.$d=m.set(d,Math.min(this.$D,m.daysInMonth())).$d}else h&&this.$d[h](p);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[k.p(t)]()},v.add=function(r,l){var d,h=this;r=Number(r);var p=k.p(l),m=function(t){var e=M(h);return k.w(e.date(e.date()+Math.round(t*r)),h)};if(p===c)return this.set(c,this.$M+r);if(p===f)return this.set(f,this.$y+r);if(p===s)return m(1);if(p===u)return m(7);var y=(d={},d[i]=e,d[o]=n,d[a]=t,d)[p]||1,v=this.$d.getTime()+r*y;return k.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var r=t||"YYYY-MM-DDTHH:mm:ssZ",a=k.z(this),i=this.$H,o=this.$m,s=this.$M,u=n.weekdays,c=n.months,l=function(t,n,a,i){return t&&(t[n]||t(e,r))||a[n].substr(0,i)},f=function(t){return k.s(i%12||12,t,"0")},d=n.meridiem||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:k.s(s+1,2,"0"),MMM:l(n.monthsShort,s,c,3),MMMM:l(c,s),D:this.$D,DD:k.s(this.$D,2,"0"),d:String(this.$W),dd:l(n.weekdaysMin,this.$W,u,2),ddd:l(n.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(i),HH:k.s(i,2,"0"),h:f(1),hh:f(2),a:d(i,o,!0),A:d(i,o,!1),m:String(o),mm:k.s(o,2,"0"),s:String(this.$s),ss:k.s(this.$s,2,"0"),SSS:k.s(this.$ms,3,"0"),Z:a};return r.replace(m,(function(t,e){return e||p[t]||a.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,d,h){var p,m=k.p(d),y=M(r),v=(y.utcOffset()-this.utcOffset())*e,g=this-y,w=k.m(this,y);return w=(p={},p[f]=w/12,p[c]=w,p[l]=w/3,p[u]=(g-v)/6048e5,p[s]=(g-v)/864e5,p[o]=g/n,p[i]=g/e,p[a]=g/t,p)[m]||g,h?w:k.a(w)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return x[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=E(t,e,!0);return r&&(n.$L=r),n},v.clone=function(){return k.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},y}(),C=O.prototype;return M.prototype=C,[["$ms",r],["$s",a],["$m",i],["$H",o],["$W",s],["$M",c],["$y",f],["$D",d]].forEach((function(t){C[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),M.extend=function(t,e){return t.$i||(t(e,O,M),t.$i=!0),M},M.locale=E,M.isDayjs=b,M.unix=function(t){return M(1e3*t)},M.en=x[w],M.Ls=x,M.p={},M}()}(O);var C=O.exports;function $(t){var n=t.chatController,r=t.actionRequest,i=n,s=k(a.default.useState(M.getInstance()),1)[0],u=k(a.default.useState(!0),2),c=u[0],l=u[1],f=k(a.default.useState(),2),d=f[0],h=f[1],p=a.default.useCallback((function(t){var e={type:"audio",value:t.message,error:t};i.setActionResponse(r,e)}),[r,i]),m=a.default.useCallback(o(v.mark((function t(){return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,s.initialize();case 3:return t.next=5,s.startRecord();case 5:l(!1),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),p(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])}))),[s,p]),y=a.default.useCallback(o(v.mark((function t(){var e;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,s.stopRecord();case 3:e=t.sent,h(e),l(!0),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),p(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])}))),[s,p]),g=a.default.useCallback((function(){if(d){var t={type:"audio",value:"Audio",audio:d};i.setActionResponse(r,t),h(void 0)}}),[r,d,i]),w=r.sendButtonText?r.sendButtonText:"Send";return a.default.createElement(e.Box,{sx:{flex:"1 1 auto",display:"flex","& > *":{flex:"1 1 auto",minWidth:0},"& > * + *":{ml:1}}},c&&a.default.createElement(e.Button,{type:"button",onClick:m,disabled:!c,variant:"contained",color:"primary",startIcon:a.default.createElement(e.Icon,null,"keyboard_voice")},"Rec start"),!c&&a.default.createElement(e.Button,{type:"button",onClick:y,disabled:c,variant:"contained",color:"primary",startIcon:a.default.createElement(e.Icon,null,"stop")},"Rec stop"),a.default.createElement(e.Button,{type:"button",onClick:g,disabled:!d,variant:"contained",color:"primary",startIcon:a.default.createElement(e.Icon,null,"send")},w))}function S(t){var n=t.chatController,r=t.actionRequest,i=n,o=k(a.default.useState([]),2),s=o[0],u=o[1],c=a.default.useCallback((function(t){var e=[];if(t)for(var n=0;n<t.length;n+=1){var r=t.item(n);r&&e.push(r)}u(e)}),[]),l=a.default.useCallback((function(){if(s.length>0){var t={type:"file",value:s.map((function(t){return t.name})).toString(),files:s};i.setActionResponse(r,t)}}),[r,i,s]),f=r.sendButtonText?r.sendButtonText:"Send";return a.default.createElement(e.Box,{sx:{flex:"1 1 auto",maxWidth:"100%",display:"flex",flexDirection:"column","& > *":{flex:"0 0 auto",maxWidth:"100%"},"& > * + *":{mt:1}}},a.default.createElement(e.List,null,s.map((function(t){return a.default.createElement("div",{key:"".concat(t.name,"-").concat(t.size)},a.default.createElement(e.Divider,null),a.default.createElement(e.ListItem,{key:t.name},a.default.createElement(e.ListItemIcon,null,a.default.createElement(e.Icon,null,"attach_file")),a.default.createElement(e.Typography,{style:{overflowWrap:"break-word",minWidth:0}},t.name)))}))),a.default.createElement(e.Box,{sx:{display:"flex","& > *":{flex:"1 1 auto",minWidth:0},"& > * + *":{ml:1}}},a.default.createElement(e.Button,{disabled:!1,component:"label",variant:"contained",color:"primary",startIcon:a.default.createElement(e.Icon,null,"folder")},"Select file",a.default.createElement("input",{type:"file",accept:r.accept,multiple:r.multiple,onChange:function(t){return c(t.target.files)},style:{display:"none"}})),a.default.createElement(e.Button,{type:"button",onClick:l,disabled:0===s.length,variant:"contained",color:"primary",startIcon:a.default.createElement(e.Icon,null,"send")},f)))}function D(t){var n=t.id,r=t.message,i=t.showDate,o=t.showTime;if(r.deletedAt)return a.default.createElement("div",{id:n});var s=r.updatedAt?r.updatedAt:r.createdAt,u=a.default.createElement(e.Box,{minWidth:0,flexShrink:0,ml:r.self?1:0,mr:r.self?0:1},a.default.createElement(e.Avatar,{alt:r.username,src:r.avatar})),c=a.default.createElement(e.Box,{maxWidth:"100%",mx:1},a.default.createElement(e.Typography,{variant:"body2",align:r.self?"right":"left"},r.username)),l=a.default.createElement(e.Box,{maxWidth:"100%",mx:1},a.default.createElement(e.Typography,{variant:"body2",align:r.self?"right":"left",color:"textSecondary"},null==s?void 0:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})));return a.default.createElement(e.Grow,{in:!0},a.default.createElement(e.Box,{maxWidth:"100%",display:"flex",flexDirection:"column"},i&&a.default.createElement(e.Typography,{align:"center"},null==s?void 0:s.toLocaleDateString()),a.default.createElement(e.Box,{id:n,maxWidth:"100%",my:1,pl:r.self?"20%":0,pr:r.self?0:"20%",display:"flex",justifyContent:r.self?"flex-end":"flex-start",style:{overflowWrap:"break-word"}},r.avatar&&!r.self&&u,a.default.createElement(e.Box,{minWidth:0,display:"flex",flexDirection:"column"},r.username&&c,a.default.createElement(e.Box,{maxWidth:"100%",py:1,px:2,bgcolor:r.self?"primary.main":"background.paper",color:r.self?"primary.contrastText":"text.primary",borderRadius:4,boxShadow:2},"text"===r.type&&a.default.createElement(e.Typography,{variant:"body1",style:{whiteSpace:"pre-wrap"}},r.content),"jsx"===r.type&&a.default.createElement("div",null,r.content)),o&&l),r.avatar&&r.self&&u)))}function A(t){var n=t.chatController,r=t.actionRequest,i=n,o=k(a.default.useState([]),2),s=o[0],u=o[1],l=a.default.useCallback((function(t){s.includes(t)?u(s.filter((function(e){return e!==t}))):u([].concat(c(s),[t]))}),[s]),f=a.default.useCallback((function(){var t=r.options.filter((function(t){return s.includes(t.value)})),e={type:"multi-select",value:t.map((function(t){return t.text})).toString(),options:t};i.setActionResponse(r,e),u([])}),[r,i,s]),d=r.sendButtonText?r.sendButtonText:"Send";return a.default.createElement(e.Box,{sx:{flex:"1 1 auto",display:"flex",flexDirection:"column","& > *":{flex:"0 0 auto",maxWidth:"100%"},"& > * + *":{mt:1}}},r.options.map((function(t){return a.default.createElement(e.Button,{key:r.options.indexOf(t),type:"button",value:t.value,onClick:function(t){return l(t.currentTarget.value)},variant:s.includes(t.value)?"contained":"outlined",color:"primary"},t.text)})),a.default.createElement(e.Button,{type:"button",onClick:f,disabled:0===s.length,variant:"contained",color:"primary",startIcon:a.default.createElement(e.Icon,null,"send")},d))}function T(t){var n=t.chatController,r=t.actionRequest,i=n,o=a.default.useCallback((function(t){var e=r.options.find((function(e){return e.value===t}));if(!e)throw new Error("Unknown value: ".concat(t));var n={type:"select",value:e.text,option:e};i.setActionResponse(r,n)}),[r,i]);return a.default.createElement(e.Box,{sx:{flex:"1 1 auto",display:"flex",flexDirection:"column","& > *":{flex:"0 0 auto",maxWidth:"100%"},"& > * + *":{mt:1}}},r.options.map((function(t){return a.default.createElement(e.Button,{key:r.options.indexOf(t),type:"button",value:t.value,onClick:function(t){return o(t.currentTarget.value)},variant:"contained",color:"primary"},t.text)})))}function R(t){var n=t.chatController,r=t.actionRequest,i=n,o=k(a.default.useState(r.defaultValue),2),s=o[0],u=o[1],c=a.default.useCallback((function(){if(s){var t={type:"text",value:s};i.setActionResponse(r,t),u("")}}),[r,i,s]),l=a.default.useCallback((function(t){t.nativeEvent.isComposing||"Enter"!==t.key||t.shiftKey||(t.preventDefault(),c())}),[c]),f=r.sendButtonText?r.sendButtonText:"Send";return a.default.createElement(e.Box,{sx:{flex:"1 1 auto",display:"flex","& > *":{flex:"1 1 auto",minWidth:0},"& > * + *":{ml:1},"& :last-child":{flex:"0 1 auto"}}},a.default.createElement(e.TextField,{placeholder:r.placeholder,value:s,onChange:function(t){return u(t.target.value)},autoFocus:!0,multiline:!0,inputProps:{onKeyDown:l},variant:"outlined",maxRows:10}),a.default.createElement(e.Button,{type:"button",onClick:c,disabled:!s,variant:"contained",color:"primary",startIcon:a.default.createElement(e.Icon,null,"send")},f))}t.AudioMediaRecorder=M,t.ChatController=g,t.MuiAudioInput=$,t.MuiChat=function(t){var n=t.chatController,r=k(a.default.useState(n.getMessages()),2),i=r[0],o=r[1],s=k(a.default.useState(n.getActionRequest()),2),u=s[0],l=s[1],f=a.default.useRef(null),d=a.default.useCallback((function(){f.current&&(f.current.scrollTop=f.current.scrollHeight)}),[f]);a.default.useEffect((function(){n.addOnMessagesChanged((function(){o(c(n.getMessages())),d()})),n.addOnActionChanged((function(){l(n.getActionRequest()),d()}))}),[n,d]);var h=a.default.useMemo((function(){return u&&"custom"===u.type?u.Component:null}),[u]),p={type:"text",content:"Unknown message.",self:!1},m=C(0),y=C(0);return a.default.createElement(e.Box,{sx:{height:"100%",width:"100%",p:1,bgcolor:"background.default",display:"flex",flexDirection:"column","& > *":{maxWidth:"100%"},"& > * + *":{mt:1}}},a.default.createElement(e.Box,{sx:{flex:"1 1 0%",overflowY:"auto",WebkitOverflowScrolling:"touch",display:"flex",flexDirection:"column","& > *":{maxWidth:"100%"}},ref:f},i.map((function(t){var e=!1,r=!!n.getOption().showDateTime;if(n.getOption().showDateTime&&!t.deletedAt){var o=C(t.updatedAt?t.updatedAt:t.createdAt);o.format("YYYYMMDD")!==m.format("YYYYMMDD")&&(e=!0),m=o,o.diff(y)<6e4?r=!1:y=o}return"text"===t.type||"jsx"===t.type?a.default.createElement(D,{key:i.indexOf(t),id:"cu-msg-".concat(i.indexOf(t)+1),message:t,showDate:e,showTime:r}):a.default.createElement(D,{key:i.indexOf(t),id:"cu-msg-".concat(i.indexOf(t)+1),message:p,showDate:e,showTime:r})}))),a.default.createElement(e.Box,{sx:{flex:"0 1 auto",display:"flex",alignContent:"flex-end","& > *":{minWidth:0}}},u&&"text"===u.type&&a.default.createElement(R,{chatController:n,actionRequest:u}),u&&"select"===u.type&&a.default.createElement(T,{chatController:n,actionRequest:u}),u&&"multi-select"===u.type&&a.default.createElement(A,{chatController:n,actionRequest:u}),u&&"file"===u.type&&a.default.createElement(S,{chatController:n,actionRequest:u}),u&&"audio"===u.type&&a.default.createElement($,{chatController:n,actionRequest:u}),u&&"custom"===u.type&&a.default.createElement(h,{chatController:n,actionRequest:u})))},t.MuiFileInput=S,t.MuiMessage=D,t.MuiMultiSelectInput=A,t.MuiSelectInput=T,t.MuiTextInput=R,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=chat-ui-react.umd.min.js.map
